# Default configuration - uses production mode
# Include this file and override MODE environment variable for different modes
services:
  search-plus-test:
    build:
      context: ../../
      dockerfile: scripts/docker/Dockerfile
    container_name: search-plus-testing
    volumes:
      - ../../test-results:/app/test-results:rw
      - ../../backups:/app/backups:rw
    # Test environment: Only pass Claude auth, no external API keys
    # This ensures docker-test.sh runs cleanly without local API leakage
    environment:
      - MODE=production  # Default mode, override with docker-compose -f docker-compose.yml -f docker-compose.clean-testing.yml up
      # Only allow Claude authentication - no external API keys
      - ANTHROPIC_AUTH_TOKEN
      - ANTHROPIC_BASE_URL
      - ANTHROPIC_MODEL
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
      - /app/tmp
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    # Resource limits
    mem_limit: 512m
    cpus: 1.0
    # Network isolation
    networks:
      - search-plus-test-network

networks:
  search-plus-test-network:
    driver: bridge